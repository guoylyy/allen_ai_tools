#!/bin/bash

# Baby æˆé•¿æ—¥è®° - ä¸€é”®éƒ¨ç½²è„šæœ¬

set -e

echo "========================================="
echo "  Baby æˆé•¿æ—¥è®° éƒ¨ç½²è„šæœ¬"
echo "========================================="

# é¡¹ç›®è·¯å¾„
PROJECT_DIR="/Users/guoyiliang/Develop/allen_ai_tools/baby-growth-tracker"
FRONTEND_DIR="$PROJECT_DIR/h5-frontend"

echo ""
echo "ğŸ“¦ æ‹‰å–æœ€æ–°ä»£ç ..."
cd "$PROJECT_DIR"
git pull origin main

echo ""
echo "ğŸ“¥ å®‰è£…åç«¯ä¾èµ–..."
cd "$PROJECT_DIR"
npm install

echo ""
echo "ğŸ“¥ å®‰è£…å‰ç«¯ä¾èµ–..."
cd "$FRONTEND_DIR"
npm install

echo ""
echo "ğŸ”„ é‡å¯ PM2 æœåŠ¡..."

# å®‰å…¨åˆ é™¤ PM2 è¿›ç¨‹ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™å¿½ç•¥é”™è¯¯ï¼‰
pm2 describe baby-growth-backend > /dev/null 2>&1 && pm2 remove baby-growth-backend || true
pm2 describe baby-growth-frontend > /dev/null 2>&1 && pm2 remove baby-growth-frontend || true


# é‡å¯åç«¯
cd $PROJECT_DIR
pm2 start npm --name "baby-growth-backend" -- run start -- --port 3001


# é‡å¯å‰ç«¯
echo "ğŸ”„ é‡å¯ å‰ç«¯ PM2 æœåŠ¡..."
cd $FRONTEND_DIR
pm2 start npm --name "baby-growth-frontend" -- run dev -- --port 3000

echo ""
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo ""
pm2 status
